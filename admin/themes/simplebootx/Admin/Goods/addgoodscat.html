<admintpl file="header" />
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight">

    <div class="row">

        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>商品分类</h5>
                </div>
                <div class="ibox-content">
                    <form class="form-horizontal m-t" id="myForm" method="post" action="" enctype="multipart/form-data">
                        <input type="hidden" name="id" value="{$edit_id}">

                        <div class="form-group">
                            <!--<label class="col-sm-3 control-label">分类名：</label>-->
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>分类名：</span></h5>
                            <div class="col-sm-5">
                                <input  name="name" class="form-control" type="text" value="{$list['name']?$list['name']:''}">

                            </div>
                        </div>
                        <div class="form-group">
                            <!--<label class="col-sm-3 control-label">上级分类：</label>-->
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>上级分类：</span></h5>

                            <div class="col-sm-5">
                            <select name="p_id"   class="col-sm-5" style="height: 30px">
                                <option value="0">顶级分类</option>
                                <foreach name="data" item="vo">
                                <option value="{$vo.id}"  <php>if($p_id==$vo['id']){</php> selected='selected'<php>}</php>  ><?php echo $vo['name']; ?></option>
                                </foreach>
                            </select>
                            </div>
                        </div>
                        <!--<div class="form-group">-->
                            <!--<label class="col-sm-3 control-label">分类图片：</label>-->
                            <!--<div class="col-sm-2">-->
                                <!--<input type="file" name="img" id="img" value="" multiple="multiple" data-show-preview="true" />-->
                            <!--</div>-->
                        <!--</div>-->









                        <div class="form-group">
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>分类图片：</span></h5>
                            <input type="file" name="img" id="img" value="" class="files"  >
                            <div style="width:100%;height: 130px;border: 1px solid #d0d6d6;margin-top: 10px;" id="imgul">
                                <span style="width:190px;height: 100px;border:1px dashed #e0e0e0;display: block;position: relative;margin: 10px 20px;">
                                    <image src="./public{$list.image}" alt="" id="imgs" style="width: 100%;height: 100%;"></image>
                                    <!--<h5 class="noimg" style="background:#C6C6C6;color: #CF5B56;position: absolute;top:-18px;right: -6px;display: none;font-size:16px;border:2px solid #e1e3e9;border-radius: 8px;">X</h5>-->
                                </span>
                            </div>
                        </div>







                        <div class="form-group">
                            <!--<label class="col-sm-3 control-label">排序：</label>-->
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>排序：</span></h5>

                            <div class="col-sm-3">
                                <input  name="sort_order" class="form-control" type="text"  value="{$list['sort_order']?$list['sort_order']:''}">
                            </div>
                        </div>
                        <div class="form-group">
                            <!--<label class="col-sm-3 control-label">分类描述：</label>-->
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>分类描述：</span></h5>

                            <div class="col-sm-5">
                                <input type="text" class="form-control" name="description" value="{$list['description']?$list['description']:''}">
                            </div>
                        </div>
                        <div class="form-group">
                            <!--<label class="col-sm-3 control-label">是否显示：</label>-->
                            <h5 class="add-article-box-title" style="font-size: 17px;"><span>是否显示：</span></h5>

                            <div class="col-sm-2">
                                <div class="radio ">
                                    <label>
                                        <input type="radio"  <php>if($list['is_show']==1){</php> checked="" <php>}</php> value="1" name="is_show"> <i></i>是
                                    </label>
                                    <label>
                                        <input type="radio" <php>if($list['is_show']==0){</php> checked="" <php>}</php>  value="0" name="is_show"> <i></i>否
                                    </label>
                                </div>

                            </div>
                        </div>

                        <div class="form-group">
                            <div class="col-sm-8 col-sm-offset-3">
                                <input type="hidden" name="edit_id" value="{$edit_id?$edit_id:0}">
                                <button class="btn btn-primary" type="button">提交</button>
                                <button class="btn btn-danger" type="button" onclick="javascript:window.history.back(-1);">返回</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- 全局js -->
<script src="__PUBLIC__/js/jquery.min.js?v=2.1.4"></script>
<script src="__PUBLIC__/js/bootstrap.min.js?v=3.3.6"></script>

<!-- 自定义js -->
<script src="__PUBLIC__/js/content.js?v=1.0.0"></script>

<!-- jQuery Validation plugin javascript-->
<script src="__PUBLIC__/js/plugins/validate/jquery.validate.min.js"></script>
<script src="__PUBLIC__/js/plugins/validate/messages_zh.min.js"></script>

<script src="__PUBLIC__/js/demo/form-validate-demo.js"></script>
<!-- iCheck -->
<script src="__PUBLIC__/js/plugins/iCheck/icheck.min.js"></script>
<script>
    $(document).ready(function () {
        $('.i-checks').iCheck({
            checkboxClass: 'icheckbox_square-green',
            radioClass: 'iradio_square-green',
        });
    });


    $(".noimg").click(function () {
        $(this).css("display", "none");
        $("#imgs").attr("src", "");
        $(".files").val('');
    })
    $(".files").change(function () {
        var objUrl = getObjectURL(this.files[0]);
        console.log("objUrl = " + objUrl);
        if (objUrl) {
            $("#imgs").attr("src", objUrl);
        }
    });
    //建立一個可存取到該file的url
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        }
        else if (window.URL != undefined) {
            // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        }
        else if (window.webkitURL != undefined) {
            // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }



    $('.btn-primary').click(function(){
        var formdata = new FormData();

        formdata.append('edit_id',$('[name="id"]').val());  //商品id
        formdata.append('name',$('[name="name"]').val());  //分类名称

        formdata.append('p_id',$('[name="p_id"] option:selected').val());  //上及 分类id
        formdata.append('description',$('[name="description"]').val());   //分类描述

        var img = $('[name="img"]').get(0).files;
        for(var i=0; i<img.length; i++){
            formdata.append('img[]',img[i]);
        }
        formdata.append('sort_order',$('[name="sort_order"]').val());  //排序
        formdata.append('is_show',$('[name="is_show"]').val());  //排序


        $.ajax({
            url: "{:U('admin/goods/addGoodsCat')}",
            type: 'POST',
            cache: false,
            data: formdata,
            processData: false,
            contentType: false,
            success:function(e){
                if(e.status==1){
                    layer.msg(e.msg,{icon:1});
                    window.location.href=e.url;
                }else{
                    layer.msg(e.msg,{icon:2});

                }
            }
        });
    });



</script>



</body>
